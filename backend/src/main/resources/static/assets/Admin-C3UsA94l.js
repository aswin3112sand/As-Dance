import{r,j as e,L as v}from"./vendor-CYIUVSsn.js";import{a as h}from"./index-B7VpOX0o.js";import"./ui-libs-CrvD3He2.js";const y=a=>a==null?"—":`₹${(Number(a)/100).toLocaleString("en-IN",{maximumFractionDigits:0})}`,S=a=>{if(!a)return"—";const t=new Date(a);return Number.isNaN(t.getTime())?"—":t.toLocaleString("en-IN")};function E(){const[a,t]=r.useState([]),[c,u]=r.useState(!0),[i,l]=r.useState(""),[o,d]=r.useState(!1),[x,j]=r.useState(""),[N,b]=r.useState(""),m=async()=>{u(!0),l("");try{const s=await h("/api/admin/purchases");if(s.status===401||s.status===403){d(!0),t([]);return}if(!s.ok)throw new Error("Unable to load purchases");const n=await s.json();t(Array.isArray(n)?n:[]),d(!1)}catch(s){l(s.message||"Failed to load")}finally{u(!1)}};r.useEffect(()=>{m()},[]);const g=async s=>{s.preventDefault(),l("");try{const n=await h("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:x,password:N})}),p=await n.json().catch(()=>({}));if(!n.ok||p.ok===!1)throw new Error(p.message||"Invalid admin credentials");j(""),b(""),d(!1),m()}catch(n){l(n.message||"Login failed")}},f=async()=>{await h("/api/admin/logout",{method:"POST"}),t([]),d(!0)};return e.jsx("div",{className:"section admin-page",children:e.jsxs("div",{className:"container-max",children:[e.jsxs("div",{className:"checkout-header admin-header",children:[e.jsxs("div",{className:"checkout-brand",children:[e.jsx("div",{className:"brand",children:"AS DANCE"}),e.jsx("div",{className:"checkout-title",children:"User Purchase"}),e.jsx("div",{className:"checkout-subtitle",children:"Admin dashboard • paid orders"})]}),e.jsxs("div",{className:"checkout-actions",children:[!o&&e.jsx("button",{className:"btn btn-outline-light",onClick:m,children:"Refresh"}),e.jsx(v,{className:"btn btn-outline-light",to:"/",children:"Home"}),!o&&e.jsx("button",{className:"btn btn-outline-light",onClick:f,children:"Logout"})]})]}),e.jsx("div",{className:"card-glass admin-card",children:o?e.jsxs("form",{className:"admin-login",onSubmit:g,children:[e.jsx("div",{className:"checkout-title-sm",children:"Admin Sign In"}),e.jsx("p",{className:"subtle",children:"Use your admin email and password to view purchases."}),i&&e.jsx("div",{className:"alert alert-danger",children:i}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label subtle",children:"Email"}),e.jsx("input",{className:"form-control",type:"email",value:x,onChange:s=>j(s.target.value),required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label subtle",children:"Password"}),e.jsx("input",{className:"form-control",type:"password",value:N,onChange:s=>b(s.target.value),required:!0})]}),e.jsx("button",{className:"btn btn-neon w-100",type:"submit",children:"Sign In"})]}):e.jsxs(e.Fragment,{children:[c&&e.jsx("div",{className:"subtle",children:"Loading purchases…"}),i&&e.jsx("div",{className:"alert alert-danger",children:i}),!c&&!i&&a.length===0&&e.jsx("div",{className:"subtle",children:"No paid purchases yet."}),!c&&a.length>0&&e.jsx("div",{className:"admin-table-wrap",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Payment ID"}),e.jsx("th",{children:"Paid At"}),e.jsx("th",{children:"Downloaded"})]})}),e.jsx("tbody",{children:a.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.fullName||"—"}),e.jsx("td",{children:s.email||"—"}),e.jsx("td",{children:y(s.amountPaise)}),e.jsx("td",{children:s.status||"—"}),e.jsx("td",{className:"admin-mono",children:s.razorpayOrderId||"—"}),e.jsx("td",{className:"admin-mono",children:s.razorpayPaymentId||"—"}),e.jsx("td",{children:S(s.paidAt)}),e.jsx("td",{children:s.downloadedAt?"Yes":"No"})]},s.purchaseId))})]})})]})})]})})}export{E as default};
