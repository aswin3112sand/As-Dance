import{r as e,j as s,L as a}from"./vendor-Dl89K0mS.js";import{a as t}from"./index-vv7Vq5Pj.js";import"./ui-libs-wGVwhxMR.js";const n=e=>{if(null==e)return"—";return`₹${(Number(e)/100).toLocaleString("en-IN",{maximumFractionDigits:0})}`},i=e=>{if(!e)return"—";const s=new Date(e);return Number.isNaN(s.getTime())?"—":s.toLocaleString("en-IN")};function l(){const[l,r]=e.useState([]),[d,c]=e.useState(!0),[o,h]=e.useState(""),[m,u]=e.useState(!1),[j,x]=e.useState(""),[N,b]=e.useState(""),p=async()=>{c(!0),h("");try{const e=await t("/api/admin/purchases");if(401===e.status||403===e.status)return u(!0),void r([]);if(!e.ok)throw new Error("Unable to load purchases");const s=await e.json();r(Array.isArray(s)?s:[]),u(!1)}catch(e){h(e.message||"Failed to load")}finally{c(!1)}};e.useEffect(()=>{p()},[]);return s.jsx("div",{className:"section admin-page",children:s.jsxs("div",{className:"container-max",children:[s.jsxs("div",{className:"checkout-header admin-header",children:[s.jsxs("div",{className:"checkout-brand",children:[s.jsx("div",{className:"brand",children:"AS DANCE"}),s.jsx("div",{className:"checkout-title",children:"User Purchase"}),s.jsx("div",{className:"checkout-subtitle",children:"Admin dashboard • paid orders"})]}),s.jsxs("div",{className:"checkout-actions",children:[!m&&s.jsx("button",{className:"btn btn-outline-light",onClick:p,children:"Refresh"}),s.jsx(a,{className:"btn btn-outline-light",to:"/",children:"Home"}),!m&&s.jsx("button",{className:"btn btn-outline-light",onClick:async()=>{await t("/api/admin/logout",{method:"POST"}),r([]),u(!0)},children:"Logout"})]})]}),s.jsx("div",{className:"card-glass admin-card",children:m?s.jsxs("form",{className:"admin-login",onSubmit:async e=>{e.preventDefault(),h("");try{const e=await t("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:j,password:N})}),s=await e.json().catch(()=>({}));if(!e.ok||!1===s.ok)throw new Error(s.message||"Invalid admin credentials");x(""),b(""),u(!1),p()}catch(s){h(s.message||"Login failed")}},children:[s.jsx("div",{className:"checkout-title-sm",children:"Admin Sign In"}),s.jsx("p",{className:"subtle",children:"Use your admin email and password to view purchases."}),o&&s.jsx("div",{className:"alert alert-danger",children:o}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label subtle",children:"Email"}),s.jsx("input",{className:"form-control",type:"email",value:j,onChange:e=>x(e.target.value),required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label subtle",children:"Password"}),s.jsx("input",{className:"form-control",type:"password",value:N,onChange:e=>b(e.target.value),required:!0})]}),s.jsx("button",{className:"btn btn-neon w-100",type:"submit",children:"Sign In"})]}):s.jsxs(s.Fragment,{children:[d&&s.jsx("div",{className:"subtle",children:"Loading purchases…"}),o&&s.jsx("div",{className:"alert alert-danger",children:o}),!d&&!o&&0===l.length&&s.jsx("div",{className:"subtle",children:"No paid purchases yet."}),!d&&l.length>0&&s.jsx("div",{className:"admin-table-wrap",children:s.jsxs("table",{className:"admin-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"User"}),s.jsx("th",{children:"Email"}),s.jsx("th",{children:"Amount"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Order ID"}),s.jsx("th",{children:"Payment ID"}),s.jsx("th",{children:"Paid At"}),s.jsx("th",{children:"Downloaded"})]})}),s.jsx("tbody",{children:l.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:e.fullName||"—"}),s.jsx("td",{children:e.email||"—"}),s.jsx("td",{children:n(e.amountPaise)}),s.jsx("td",{children:e.status||"—"}),s.jsx("td",{className:"admin-mono",children:e.razorpayOrderId||"—"}),s.jsx("td",{className:"admin-mono",children:e.razorpayPaymentId||"—"}),s.jsx("td",{children:i(e.paidAt)}),s.jsx("td",{children:e.downloadedAt?"Yes":"No"})]},e.purchaseId))})]})})]})})]})})}export{l as default};
