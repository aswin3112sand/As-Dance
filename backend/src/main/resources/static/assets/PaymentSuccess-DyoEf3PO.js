import{u as g,r as c,j as e,L as x}from"./vendor-CYIUVSsn.js";import{u as N,a as k}from"./index-B7VpOX0o.js";import{l as D}from"./paymentStorage-DeWr5p_q.js";import"./ui-libs-CrvD3He2.js";const w=s=>{const l=Number(s);return!Number.isFinite(l)||l<=0?"₹499":`₹${Math.round(l/100)}`};function L(){const{user:s}=N(),o=g().state||{},n=c.useMemo(()=>D(s==null?void 0:s.id),[s==null?void 0:s.id]),i=o.orderId||(n==null?void 0:n.orderId)||"",d=o.paymentId||(n==null?void 0:n.paymentId)||"",j=w(o.amountPaise??o.amount??(n==null?void 0:n.amountPaise)??(n==null?void 0:n.amount)),b=o.googleDriveUrl||(n==null?void 0:n.googleDriveUrl)||"",m=o.paidAt||(n==null?void 0:n.paidAt)||null,[a,u]=c.useState(null),t=b||(a==null?void 0:a.unlockedVideoUrl)||"";c.useEffect(()=>{let r=!0;async function p(){try{const f=await k("/api/payment/status"),y=await f.json().catch(()=>null);if(!r)return;u(y&&f.ok?y:{unlocked:!1})}catch{r&&u({unlocked:!1})}}return p(),()=>{r=!1}},[]),c.useEffect(()=>{if(t&&(a==null?void 0:a.unlocked)!==!1){const r=setTimeout(()=>{window.open(t,"_blank","noopener,noreferrer")||(window.location.href=t)},2e3);return()=>clearTimeout(r)}},[t,a==null?void 0:a.unlocked]);const h=m?new Date(m).toLocaleString():"",v=a&&!a.unlocked;return e.jsx("section",{className:"section payment-result-page",children:e.jsx("div",{className:"container-max",children:e.jsxs("div",{className:"payment-result-card card-glass",children:[e.jsx("div",{className:"payment-result-icon is-success","aria-hidden":"true",children:"OK"}),e.jsx("h1",{className:"payment-result-title",children:"Payment Successful"}),e.jsx("p",{className:"payment-result-subtitle",children:"Your 639-step bundle is unlocked. Thank you for the purchase."}),e.jsxs("div",{className:"payment-result-meta",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Amount:"})," ",j]}),i&&e.jsxs("div",{children:[e.jsx("span",{children:"Order ID:"})," ",i]}),d&&e.jsxs("div",{children:[e.jsx("span",{children:"Payment ID:"})," ",d]}),h&&e.jsxs("div",{children:[e.jsx("span",{children:"Paid:"})," ",h]})]}),e.jsxs("div",{className:"payment-result-actions",children:[t&&e.jsx("a",{href:t,className:"btn btn-cta btn-hero btn-cta-primary",children:"Access Google Drive Folder"}),e.jsx(x,{className:"btn btn-cta btn-hero btn-cta-primary",to:"/dashboard",children:"Go to Dashboard"}),e.jsx(x,{className:"btn btn-outline-light",to:"/",children:"Back to Home"})]}),t&&(a==null?void 0:a.unlocked)!==!1&&e.jsx("p",{className:"payment-result-subtitle",style:{marginTop:"1rem",fontSize:"0.9rem"},children:"Redirecting to Google Drive in 2 seconds..."}),v&&e.jsx("p",{className:"payment-result-subtitle",role:"alert",style:{marginTop:"1rem",fontSize:"0.9rem"},children:"We could not verify your payment on refresh. Please check your dashboard or contact support."})]})})})}export{L as default};
