import{r as e,j as a,L as s}from"./vendor-BptZdHlD.js";import{a as t}from"./index-DqclkoKh.js";const n=e=>{if(null==e)return"—";return`₹${(Number(e)/100).toLocaleString("en-IN",{maximumFractionDigits:0})}`},i=e=>{if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?"—":a.toLocaleString("en-IN")};function r(){const[r,l]=e.useState([]),[d,c]=e.useState(!0),[o,m]=e.useState(""),[h,u]=e.useState(!1),[j,x]=e.useState(""),[N,p]=e.useState(""),b=async()=>{c(!0),m("");try{const e=await t("/api/admin/purchases");if(401===e.status||403===e.status)return u(!0),void l([]);if(!e.ok)throw new Error("Unable to load purchases");const a=await e.json();l(Array.isArray(a)?a:[]),u(!1)}catch(e){m(e.message||"Failed to load")}finally{c(!1)}};e.useEffect(()=>{b()},[]);return a.jsx("div",{className:"section admin-page",children:a.jsxs("div",{className:"container-max",children:[a.jsxs("div",{className:"checkout-header admin-header",children:[a.jsxs("div",{className:"checkout-brand",children:[a.jsx("div",{className:"brand",children:"AS DANCE"}),a.jsx("div",{className:"checkout-title",children:"User Purchase"}),a.jsx("div",{className:"checkout-subtitle",children:"Admin dashboard • paid orders"})]}),a.jsxs("div",{className:"checkout-actions",children:[!h&&a.jsx("button",{className:"btn btn-outline-light",onClick:b,children:"Refresh"}),a.jsx(s,{className:"btn btn-outline-light",to:"/",children:"Home"}),!h&&a.jsx("button",{className:"btn btn-outline-light",onClick:async()=>{await t("/api/admin/logout",{method:"POST"}),l([]),u(!0)},children:"Logout"})]})]}),a.jsx("div",{className:"card-glass admin-card",children:h?a.jsxs("form",{className:"admin-login",onSubmit:async e=>{e.preventDefault(),m("");try{const e=await t("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:j,password:N})}),a=await e.json().catch(()=>({}));if(!e.ok||!1===a.ok)throw new Error(a.message||"Invalid admin credentials");x(""),p(""),u(!1),b()}catch(a){m(a.message||"Login failed")}},children:[a.jsx("div",{className:"checkout-title-sm",children:"Admin Sign In"}),a.jsx("p",{className:"subtle",children:"Use your admin email and password to view purchases."}),o&&a.jsx("div",{className:"alert alert-danger",children:o}),a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"form-label subtle",htmlFor:"admin-email",children:"Email"}),a.jsx("input",{id:"admin-email",className:"form-control",type:"email",value:j,onChange:e=>x(e.target.value),required:!0,autoComplete:"username"})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"form-label subtle",htmlFor:"admin-password",children:"Password"}),a.jsx("input",{id:"admin-password",className:"form-control",type:"password",value:N,onChange:e=>p(e.target.value),required:!0,autoComplete:"current-password"})]}),a.jsx("button",{className:"btn btn-neon w-100",type:"submit",children:"Sign In"})]}):a.jsxs(a.Fragment,{children:[d&&a.jsx("div",{className:"subtle",children:"Loading purchases…"}),o&&a.jsx("div",{className:"alert alert-danger",children:o}),!d&&!o&&0===r.length&&a.jsx("div",{className:"subtle",children:"No paid purchases yet."}),!d&&r.length>0&&a.jsx("div",{className:"admin-table-wrap",children:a.jsxs("table",{className:"admin-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"User"}),a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Amount"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Order ID"}),a.jsx("th",{children:"Payment ID"}),a.jsx("th",{children:"Paid At"}),a.jsx("th",{children:"Downloaded"})]})}),a.jsx("tbody",{children:r.map(e=>a.jsxs("tr",{children:[a.jsx("td",{children:e.fullName||"—"}),a.jsx("td",{children:e.email||"—"}),a.jsx("td",{children:n(e.amountPaise)}),a.jsx("td",{children:e.status||"—"}),a.jsx("td",{className:"admin-mono",children:e.razorpayOrderId||"—"}),a.jsx("td",{className:"admin-mono",children:e.razorpayPaymentId||"—"}),a.jsx("td",{children:i(e.paidAt)}),a.jsx("td",{children:e.downloadedAt?"Yes":"No"})]},e.purchaseId))})]})})]})})]})})}export{r as default};
