import{d as e,r as a,j as s,L as t,e as c}from"./vendor-Dl89K0mS.js";import{a as n,u as r}from"./index-CW194nD9.js";import{W as i}from"./icons-B58UmnIq.js";import{c as o,a as l,s as d,b as u}from"./paymentStorage-CYG686oq.js";import"./ui-libs-wGVwhxMR.js";async function m(e){const a=await n("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:null==e?void 0:e.orderId,razorpay_payment_id:null==e?void 0:e.paymentId,razorpay_signature:(null==e?void 0:e.signature)||""})}),s=await a.json().catch(()=>({}));return{ok:a.ok&&!1!==s.ok,data:s,status:a.status}}const h="/assets/poster-CQH4Ncyo.webp",p=()=>{const p=e(),{user:y}=r(),[v,k]=a.useState([]),[j,x]=a.useState(!1),N=a.useRef(null),f=a.useRef(null),g=a.useRef(!1),b=a.useRef(!1);a.useEffect(()=>{(async()=>{const{ok:e,data:a}=await async function(){const e=await n("/api/payment/status"),a=await e.json().catch(()=>null);return{ok:e.ok&&!!a,data:a}}();e&&a.unlocked&&p("/dashboard")})()},[p]);const w=async()=>{var e,a,s,t,c,r;if(g.current)return;g.current=!0,x(!0),k([]),o(),l();const i=(null==(a=null==(e=N.current)?void 0:e.value)?void 0:a.trim())||"",v=(e=>{const a=(e=>(e||"").replace(/[^\d]/g,""))(e);return a?a.length<10?null:a:""})((null==(s=f.current)?void 0:s.value)||"");if(null===v)return k(["Enter a valid WhatsApp number or leave it blank."]),x(!1),void(g.current=!1);const j=v||"",w=i||(null==y?void 0:y.fullName)||(null==(t=null==y?void 0:y.email)?void 0:t.split("@")[0])||"";let P;try{P=await async function(e){const a=await n("/api/payment/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e||{})}),s=await a.json().catch(()=>({}));return{ok:a.ok&&!1!==s.ok,data:s,status:a.status}}({buyerName:i,buyerPhone:j})}catch(S){return k(["Unable to reach the payment server. Please try again."]),x(!1),void(g.current=!1)}const{ok:I,data:_}=P;if(!I)return k([_.message||"Failed to create payment order"]),x(!1),void(g.current=!1);if("MOCK"===_.mode){const e=`pay_mock_${Date.now()}`;let a;try{a=await m({orderId:_.orderId,paymentId:e,signature:""})}catch(S){return k(["Payment verification failed. Please try again."]),x(!1),void(g.current=!1)}if(a.ok){const s={orderId:_.orderId,paymentId:e,amountPaise:_.amountPaise,googleDriveUrl:null==(c=a.data)?void 0:c.unlockedVideoUrl};d(s,null==y?void 0:y.id),x(!1),g.current=!1,p("/payment-success",{state:s})}else{const e={reason:(null==(r=a.data)?void 0:r.message)||"Payment failed. Please try again."};u(e,null==y?void 0:y.id),x(!1),g.current=!1,p("/payment-failed",{state:e})}return}if(!(await new Promise(e=>{const a="razorpay-checkout-js";if("undefined"!=typeof window&&window.Razorpay)return b.current=!0,e(!0);const s=document.getElementById(a);s&&s.remove();const t=document.createElement("script");t.id=a,t.src="https://checkout.razorpay.com/v1/checkout.js",t.async=!0,t.onload=()=>{b.current=!0,e(!0)},t.onerror=()=>{e(!1)},document.body.appendChild(t)})))return k(["Failed to load payment gateway. Please try again."]),x(!1),void(g.current=!1);if(!_.keyId||!_.orderId)return k(["Payment configuration missing. Please contact support."]),x(!1),void(g.current=!1);const z={key:_.keyId||"rzp_test_S1mk723Rt4DSsp",amount:_.amountPaise,currency:_.currency||"INR",name:"As Dance",description:"Unlock Premium Content",image:h,order_id:_.orderId,handler:async e=>{var a,s;let t;try{t=await m({orderId:e.razorpay_order_id||_.orderId,paymentId:e.razorpay_payment_id,signature:e.razorpay_signature})}catch(S){const a={reason:"Payment verification failed. Please try again."};return u(a,null==y?void 0:y.id),x(!1),g.current=!1,void p("/payment-failed",{state:a})}if(t.ok){const s={orderId:e.razorpay_order_id||_.orderId,paymentId:e.razorpay_payment_id,amountPaise:_.amountPaise,googleDriveUrl:null==(a=t.data)?void 0:a.unlockedVideoUrl};d(s,null==y?void 0:y.id),x(!1),g.current=!1,p("/payment-success",{state:s})}else{const e={reason:(null==(s=t.data)?void 0:s.message)||"Payment failed. Please try again."};u(e,null==y?void 0:y.id),x(!1),g.current=!1,p("/payment-failed",{state:e})}},prefill:{name:w,email:(null==y?void 0:y.email)||void 0,contact:j},theme:{color:"#3399cc"},modal:{ondismiss:()=>{x(!1),g.current=!1}}};try{const e=new window.Razorpay(z);e.on("payment.failed",e=>{var a;const s={reason:(null==(a=null==e?void 0:e.error)?void 0:a.description)||"Payment failed. Please try again."};u(s,null==y?void 0:y.id),x(!1),g.current=!1,p("/payment-failed",{state:s})}),e.open()}catch(S){k(["Failed to open payment gateway. Please try again."]),x(!1),g.current=!1}};return s.jsx("section",{className:"checkout-page",children:s.jsxs("div",{className:"checkout-shell container-max",children:[s.jsxs("div",{className:"checkout-top-actions",children:[s.jsx(t,{className:"btn btn-outline-light",to:"/",children:"Home"}),s.jsx("button",{className:"btn btn-outline-light",type:"button",onClick:()=>p(-1),children:"Back"})]}),s.jsxs("div",{className:"checkout-float",children:[s.jsxs("div",{className:"checkout-left",children:[s.jsx("div",{className:"checkout-micro-stats",children:"Secure Checkout"}),s.jsx("div",{className:"checkout-brandline",children:"AS DANCE"}),s.jsx("div",{className:"checkout-title-sm",children:"Unlock the 639-Step Bundle"}),s.jsx("div",{className:"checkout-subtitle",children:"One-time payment. Instant unlock. Lifetime access."}),s.jsxs("div",{className:"checkout-steps",children:[s.jsx("span",{className:"checkout-step is-complete",children:"Details"}),s.jsx("span",{className:"checkout-step-divider",children:"•"}),s.jsx("span",{className:"checkout-step is-active",children:"Payment"}),s.jsx("span",{className:"checkout-step-divider",children:"•"}),s.jsx("span",{className:"checkout-step",children:"Unlock"})]}),s.jsx("p",{className:"checkout-body",children:"Your bundle unlocks 639 curated steps across easy, medium, and hard routines. Fill in optional contact details so we can reach you instantly after payment."}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),w()},children:[s.jsxs("div",{className:"checkout-field-grid",children:[s.jsxs("div",{className:"checkout-field",children:[s.jsxs("label",{className:"checkout-field-label",htmlFor:"checkout-name",children:["Full Name ",s.jsx("span",{className:"checkout-optional",children:"(optional)"})]}),s.jsx("input",{id:"checkout-name",ref:N,type:"text",className:"checkout-input",placeholder:"Your name",autoComplete:"name"})]}),s.jsxs("div",{className:"checkout-field",children:[s.jsxs("label",{className:"checkout-field-label",htmlFor:"checkout-phone",children:["WhatsApp ",s.jsx("span",{className:"checkout-optional",children:"(optional)"})]}),s.jsx("input",{id:"checkout-phone",ref:f,type:"tel",className:"checkout-input",placeholder:"WhatsApp number",inputMode:"tel",autoComplete:"tel"}),s.jsx("span",{className:"checkout-hint",children:"Enter 10+ digits or leave blank."})]})]}),s.jsx("div",{className:"checkout-actions-row",children:s.jsx("button",{className:"checkout-btn checkout-btn-primary",type:"submit",disabled:j,children:j?"Processing...":"Buy Now"})})]}),j&&s.jsxs("div",{className:"checkout-processing","aria-live":"polite",children:[s.jsx("span",{className:"checkout-spinner","aria-hidden":"true"}),"Payment window is loading..."]}),v.map((e,a)=>s.jsx("div",{className:"checkout-message",role:"alert",children:e},`checkout-msg-${a}`))]}),s.jsx("div",{className:"checkout-right",children:s.jsxs("div",{className:"checkout-summary-card",children:[s.jsx("div",{className:"checkout-label",children:"Order Summary"}),s.jsx("div",{className:"bundle-preview",children:s.jsx("img",{src:h,alt:"Bundle Preview",loading:"lazy",decoding:"async",width:"640",height:"360"})}),s.jsxs("div",{className:"checkout-summary-row",children:[s.jsx("span",{children:"Bundle Access"}),s.jsx("span",{className:"checkout-summary-value",children:"₹499"})]}),s.jsxs("div",{className:"checkout-summary-row total",children:[s.jsx("span",{children:"Total"}),s.jsx("span",{className:"checkout-summary-value",children:"₹499"})]}),s.jsx("button",{className:"checkout-summary-cta",type:"button",onClick:w,disabled:j,children:j?"Processing...":"Pay ₹499"}),s.jsx("div",{className:"checkout-trust-divider"}),s.jsxs("div",{className:"checkout-trust-row",children:[s.jsx("span",{className:"checkout-trust-item",children:"Secure Payment"}),s.jsx("span",{className:"checkout-trust-item",children:"Instant Unlock"}),s.jsx("span",{className:"checkout-trust-item",children:"Lifetime Access"})]}),s.jsx("div",{className:"checkout-receipt",children:"Receipt delivered instantly after payment."}),s.jsxs("div",{className:"checkout-support",children:[s.jsxs("div",{className:"checkout-support-item",children:[s.jsx(i,{size:18,className:"support-icon","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("div",{className:"support-label",children:"WhatsApp Support"}),s.jsx("div",{className:"support-value",children:"+91 88256 02356"})]})]}),s.jsxs("div",{className:"checkout-support-item",children:[s.jsx(c,{size:18,className:"support-icon","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("div",{className:"support-label",children:"Email"}),s.jsx("div",{className:"support-value",children:s.jsx("a",{href:"mailto:bussinessaswin@gmail.com","aria-label":"Email support",children:"bussinessaswin@gmail.com"})})]})]})]}),s.jsx("div",{className:"checkout-trust-note",children:"Complete payment to unlock your dashboard."})]})})]})]})})};export{p as default};
