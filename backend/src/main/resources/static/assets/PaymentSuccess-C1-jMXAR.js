import{u as e,r as n,j as s,L as t}from"./vendor-Dl89K0mS.js";import{u as a,a as l}from"./index-DeZwUSL-.js";import{l as r}from"./paymentStorage-CYG686oq.js";import"./ui-libs-wGVwhxMR.js";function o(){const{user:o}=a(),i=e().state||{},c=n.useMemo(()=>r(null==o?void 0:o.id),[null==o?void 0:o.id]),d=i.orderId||(null==c?void 0:c.orderId)||"",u=i.paymentId||(null==c?void 0:c.paymentId)||"",m=(e=>{const n=Number(e);return!Number.isFinite(n)||n<=0?"₹499":`₹${Math.round(n/100)}`})(i.amountPaise??i.amount??(null==c?void 0:c.amountPaise)??(null==c?void 0:c.amount)),h=i.googleDriveUrl||(null==c?void 0:c.googleDriveUrl)||"",p=i.paidAt||(null==c?void 0:c.paidAt)||null,[j,v]=n.useState(null),y=h||(null==j?void 0:j.unlockedVideoUrl)||"";n.useEffect(()=>{let e=!0;return async function(){try{const n=await l("/api/payment/status"),s=await n.json().catch(()=>null);if(!e)return;v(s&&n.ok?s:{unlocked:!1})}catch{e&&v({unlocked:!1})}}(),()=>{e=!1}},[]),n.useEffect(()=>{if(y&&!1!==(null==j?void 0:j.unlocked)){const e=setTimeout(()=>{window.open(y,"_blank","noopener,noreferrer")||(window.location.href=y)},2e3);return()=>clearTimeout(e)}},[y,null==j?void 0:j.unlocked]);const x=p?new Date(p).toLocaleString():"",b=j&&!j.unlocked;return s.jsx("section",{className:"section payment-result-page",children:s.jsx("div",{className:"container-max",children:s.jsxs("div",{className:"payment-result-card card-glass",children:[s.jsx("div",{className:"payment-result-icon is-success","aria-hidden":"true",children:"OK"}),s.jsx("h1",{className:"payment-result-title",children:"Payment Successful"}),s.jsx("p",{className:"payment-result-subtitle",children:"Your 639-step bundle is unlocked. Thank you for the purchase."}),s.jsxs("div",{className:"payment-result-meta",children:[s.jsxs("div",{children:[s.jsx("span",{children:"Amount:"})," ",m]}),d&&s.jsxs("div",{children:[s.jsx("span",{children:"Order ID:"})," ",d]}),u&&s.jsxs("div",{children:[s.jsx("span",{children:"Payment ID:"})," ",u]}),x&&s.jsxs("div",{children:[s.jsx("span",{children:"Paid:"})," ",x]})]}),s.jsxs("div",{className:"payment-result-actions",children:[y&&s.jsx("a",{href:y,className:"btn btn-cta btn-hero btn-cta-primary",children:"Access Google Drive Folder"}),s.jsx(t,{className:"btn btn-cta btn-hero btn-cta-primary",to:"/dashboard",children:"Go to Dashboard"}),s.jsx(t,{className:"btn btn-outline-light",to:"/",children:"Back to Home"})]}),y&&!1!==(null==j?void 0:j.unlocked)&&s.jsx("p",{className:"payment-result-subtitle",style:{marginTop:"1rem",fontSize:"0.9rem"},children:"Redirecting to Google Drive in 2 seconds..."}),b&&s.jsx("p",{className:"payment-result-subtitle",role:"alert",style:{marginTop:"1rem",fontSize:"0.9rem"},children:"We could not verify your payment on refresh. Please check your dashboard or contact support."})]})})})}export{o as default};
